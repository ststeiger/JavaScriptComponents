<!DOCTYPE html>
<head>
    <title></title>
    <meta charset="utf-8">
    <style>
        .country
        {
            fill: #222;
        }

        .canton-boundaries
        {
            fill: none;
            stroke: #fff;
            stroke-width: 1;
        }

        .municipality-boundaries
        {
            fill: none;
            stroke: #fff;
            stroke-width: .3;
        }
    </style>
</head>
<body>
    <script src="d3.v3.min.js"></script>
    <script src="topojson.v1.min.js"></script>
    <script>

        var width = 960, height = 500;
        var path = d3.geo.path().projection(null);

        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);


        var swissData = [];


        d3.json("ch.json",
            function (error, ch)
            {
                svg.append("path")
                .datum(topojson.feature(ch, ch.objects.country))
                .attr("class", "country")
                .attr("d", path)
                ;

                svg.append("path")
                .datum(topojson.mesh(ch, ch.objects.municipalities, function (a, b) { return a !== b; }))
                .attr("class", "municipality-boundaries")
                .attr("d", path)
                ;

                svg.selectAll(".municipalities")
                    .data(topojson.feature(ch, ch.objects.municipalities).features)
                    .enter().append("path")
                    .attr("class", function (d) { 
                        // console.log(d.properties.name); console.log(d.properties.name);
                        swissData.push(
                            {
                                 id: d.id
                                ,name: d.properties.name
                            }
                        );

                        return "municipalities " + d.id; 
                    })
                    .attr("class", "municipality-boundaries")
                    .attr("d", path)
                ;

                console.log(swissData);

                var url = "../ajax/Data.ashx";
                d3.xhr(url)
                    .header("Content-Type", "application/json")
                    .post(
                        //JSON.stringify({ year: "2012", customer: "type1" }),
                        JSON.stringify(swissData),
                        function (err, rawData)
                        {
                            var data = JSON.parse(rawData);
                            console.log("got response", data);
                        }
                    );


                /*
                svg.append("path")
                .datum(topojson.mesh(ch, ch.objects.cantons, function(a, b) { return a !== b; }))
                .attr("class", "canton-boundaries")
                .attr("d", path)
                ;
                */
            }
        );

    </script>
</body>
</html>
